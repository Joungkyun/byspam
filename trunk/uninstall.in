#!/bin/sh
VERSION=@byversion@

level="@level@"
bindir="@bindir@"
confdir="@confdir@"
filterdir="@filterdir@"
includedir="@includedir@"
procpath="@procpath@"

dirlist="filterdir confdir includedir bindir"
list=$(cat ${confdir}/install.log | sed -n -e '/^#=.*/p' | sed 's/^#=//g' )

# remove file
for i in ${list}
do
  if [ -f "${i}" ]; then
    rm -f ${i}
    echo "Removed ${i}"
  fi
done

# unregisted procmailrc
procchk=$(egrep "^INCLUDERC=.+\/filter\.rc" ${procpath})
if [ -n "${procchk}" ]; then
  CHK=
  procchk=$(echo ${procchk} | sed -e 's/\//\\\//g')
  procchk=$(echo ${procchk} | sed -e 's/filter\.rc/filter\\\.rc/g')
  @PERLPATH@ -p -i -e 's/^[ \t]*INCLUDERC=.+\/filter\.rc[\s]*//mg' ${procpath}
  CHK=$?

  if [ "${CHK}" = 0 ]; then
    echo "removed byspam registration in procmail"
  else
    echo "Failed remove byspam registration in procmail"
  fi
fi

for i in ${dirlist}
do
  eval dirpath='$'${i}

  if [ -d "${dirpath}" ]; then
    dirchk=$(echo ${dirpath} | grep -v "^\(/sbin\|/usr\/sbin\|/usr/local/sbin\|/bin\|/usr/bin\|/usr/local/bin\|/etc\|/usr/local/etc\|/usr/include\|/usr/local/include\)$")
    if [ -n "${dirchk}" ]; then
      echo -n "Do you want remove ${dirpath}? [y/n] : "
      read answer

      case ${answer} in
        y|Y)
          rm -rf ${dirpath}
          ;;
      esac
    fi
  fi
done

exit 0
